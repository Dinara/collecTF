{% extends "base.html" %}

{% load bootstrap_tags %}

{% block content %}


<div class="row-fluid">
<!--
<div class="span3 bs-docs-sidebar">
<ul class="nav nav-list bs-docs-sidenav affix" id="sidebar">
  <li><a href="#browse-form"><i class="icon-chevron-right"></i>Browse database</a></li>
  <li><a href="#weblogo"><i class="icon-chevron-right"></i>Sequence logo</a></li>
  <li><a href="#sites"><i class="icon-chevron-right"></i>List of binding sites</a></li>
  <li><a href="#export"><i class="icon-chevron-right"></i>Export data</a></li>
</ul>
</div>
-->
<div class="span12">

<div class="page-header" id="browse-form">
<h2>Browse database</h2>

You can select a particular transcription factor and species to
search for curation binding sites in the database.
</div>
<form method="POST" action="" class="form-horizontal">{% csrf_token %}
  {{ form|as_bootstrap }}
  <div class="control-group">
    <div class="controls">
      <input class="btn" type="submit" value="submit" />
    </div>
  </div>
</form>

{% if site_curation_dict and site_regulation_dict %}

<script type="text/javascript">
window.location.hash = '#results';
</script>

<h1 id="results">Collection of binding sites for {{ TF.name }} transcription factor in {{ species.name }}</h1>


<!-- weblogo here 
<div class="page-header" id="weblogo">
<h2>Sequence logo</h2>
</div>
<img src="{{ weblogo_image_data }}">
 weblogo end -->


<div class="page-header" id="sites">
<h2>List of transcription factor binding sites</h2>
For the selected transcription factor and species, the list of curated binding sites in the database are displayed below.
</div>

{% load utils %}
<table class="table table-condensed table-borderless">
  <thead>
    <tr>
      <th width="20%"></th>
      <th width="20%">Gene</th>
      <th width="40%">Function</th>
      <th width="20%">Curation</th>
    </tr>
  </thead>
  <tbody>
    {% for site in site_curation_dict|get_keys %}
    <tr><td colspan="4"><hr /></td></tr>
    <tr>
      <td colspan="3"><span class="sequence">{{ site.seq }}</span></td>
      <td>{% for cur in site_curation_dict|get_item:site %}
	<a href="{% url collectfapp.viewcurationview.view_curation cur.curation_id %}">[{{cur.curation_id}}]</a>{% if not forloop.last %}, {% endif %}
	{% endfor %}
      </td>
    </tr>

    <tr>
      <td colspan="4">
	<div class="operon">{% with regs=site_regulation_dict|get_item:site %} {{ regs|regulation_diagram:site }} {% endwith %}</div>
	<!-- <span class="sequence">{{ site.seq }}</span> -->
      </td>
    </tr>

    {% for reg in site_regulation_dict|get_item:site %}
    <tr>
      <td></td>
      <td>{{reg.gene.name}} ({{ reg.gene.locus_tag }})</td>
      <td>{{reg.gene.description}}</td>
      <td></td>
    </tr>
    {% endfor %}
          
    {% endfor %}
  </tbody>
</table>

<hr />
<div class="page-header" id="export">
<h2>Export</h2>
<p>Export the list of binding sites in csv or fasta formats.</p>
<p>
<form action="{% url browseapp.views.export_sites %}" method="POST">{% csrf_token %}
{% for site in site_curation_dict|get_keys %}
<input type="hidden" name="site_id" value="{{ site.site_id }}" />
{% endfor %}
<input type="submit" value="Download FASTA" class="btn btn-primary btn-large" name="fasta">
<input type="submit" value="Download CSV" class="btn btn-primary btn-large" name="csv">
</form>
</p>
</div>

{% endif %}

</div>

</div>

{% endblock %}

